{
  "Version": "2019-10-30",
  "StartAction": "start",
  "Metadata": {
    "entryPointPosition": { "x": 10, "y": 10 },
    "snapToGrid": true,
    "Name": "vanity-numbers-flow",
    "Description": "Invoke Lambda to get vanity options and speak top 3"
  },
  "Actions": [
    {
      "Identifier": "start",
      "Type": "Start",
      "Transitions": {
        "NextAction": "invoke-vanity",
        "Errors": []
      }
    },
    {
      "Identifier": "invoke-vanity",
      "Type": "InvokeLambdaFunction",
      "Parameters": {
        "LambdaFunctionARN": "${lambda_arn}",
        "InvocationTimeLimitSeconds": 5,
        "RequestAttributes": {}
      },
      "Transitions": {
        "NextAction": "speak-results",
        "Errors": [
          { "ErrorType": "InvalidLambdaResponse", "NextAction": "fallback" },
          { "ErrorType": "NoMatchingError",         "NextAction": "fallback" },
          { "ErrorType": "LambdaServiceError",      "NextAction": "fallback" },
          { "ErrorType": "LambdaThrottling",        "NextAction": "fallback" },
          { "ErrorType": "LambdaUnknown",           "NextAction": "fallback" }
        ]
      }
    },
    {
      "Identifier": "speak-results",
      "Type": "MessageParticipant",
      "Parameters": {
        "TextToSpeechType": "ssml",
        "SSML": "{External.prompt_ssml}"
      },
      "Transitions": {
        "NextAction": "disconnect",
        "Errors": [
          { "ErrorType": "NoMatchingError", "NextAction": "fallback" }
        ]
      }
    },
    {
      "Identifier": "fallback",
      "Type": "MessageParticipant",
      "Parameters": {
        "Text": "Sorry, I couldn't compute vanity options right now. Please try again later."
      },
      "Transitions": {
        "NextAction": "disconnect",
        "Errors": []
      }
    },
    {
      "Identifier": "disconnect",
      "Type": "DisconnectParticipant",
      "Transitions": { "Errors": [] }
    }
  ]
}